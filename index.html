<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Werwolf Spiel</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  .wrap { margin-bottom: 20px; }
  .row { display: flex; align-items: center; margin-bottom: 8px; }
  label { width: 150px; }
  select { margin-left: 10px; }
  button { margin: 5px; }
  #playersList, #playersStatusList { list-style: none; padding: 0; }
  .roleTag { margin-left: 10px; font-weight: bold; }
  #roleMismatchWarning { color: red; margin-top: 10px; font-weight: bold; }
</style>
</head>
<body>

<h1>Werwolf Spiel</h1>

<h2>Spieler hinzuf√ºgen</h2>
<input type="text" id="playerName" placeholder="Name des Spielers"/>
<button id="addPlayer">Hinzuf√ºgen</button>
<button id="clearPlayers">Alle entfernen</button>

<h2>Spieler Liste</h2>
<ul id="playersList"></ul>
<h2>Spieler Status & Rollen</h2>
<ul id="playersStatusList"></ul>

<div id="roleMismatchWarning"></div> <!-- Warnung hier anzeigen -->

<h2>Rollen konfigurieren</h2>
<div id="rolesControls" class="wrap"></div>
<button id="autoFillVillagers">Alle Dorfbewohner</button>
<button id="assignRoles">Rollen zuf√§llig verteilen</button>
<button id="clearRoles">Rollen zur√ºcksetzen</button>

<h2>Spiel starten</h2>
<button id="startNight">Nacht starten</button>
<button id="startDay">Tag starten</button>
<button id="restartGame">Neues Spiel</button>

<div id="log"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const players = [];
  const roles = {}; // roleName: count
  const playersStatus = {}; // playerName: {alive: true/false, role: 'roleName'}
  
  const playerNameInput = document.getElementById('playerName');
  const addPlayerBtn = document.getElementById('addPlayer');
  const clearPlayersBtn = document.getElementById('clearPlayers');
  const playersList = document.getElementById('playersList');
  const playersStatusList = document.getElementById('playersStatusList');
  const rolesControlsContainer = document.getElementById('rolesControls');
  const autoFillVillagersBtn = document.getElementById('autoFillVillagers');
  const assignRolesBtn = document.getElementById('assignRoles');
  const clearRolesBtn = document.getElementById('clearRoles');
  const roleWarningDiv = document.getElementById('roleMismatchWarning');

  const availableRoles = ['Dorfbewohner', 'Werwolf', 'Seher', 'Hexe', 'J√§ger', 'B√ºrgermeister'];

  // Funktion um die Spieleranzeige zu aktualisieren
  function updatePlayersDisplay() {
    // Listen leeren
    playersList.innerHTML = '';
    playersStatusList.innerHTML = '';

    players.forEach(name => {
      // Spieler Liste
      const li = document.createElement('li');
      li.textContent = name;
      const statusSpan = document.createElement('span');
      statusSpan.textContent = playersStatus[name]?.alive ? 'üü¢' : 'üî¥';
      li.appendChild(statusSpan);
      playersList.appendChild(li);

      // Spieler Details mit Rollenzuweisung und Dropdown
      const statusLi = document.createElement('li');
      statusLi.textContent = name + ' (' + (playersStatus[name]?.alive ? 'lebend' : 'tot') + ')';

      // Role display
      const roleSpan = document.createElement('span');
      roleSpan.className = 'roleTag';
      roleSpan.textContent = playersStatus[name]?.role || 'Unbekannt';
      statusLi.appendChild(roleSpan);

      // Dropdown f√ºr manuelle Rollenzuweisung
      const roleSelect = document.createElement('select');
      roleSelect.innerHTML = availableRoles.map(r => `<option value="${r}">${r}</option>`).join('');
      roleSelect.value = playersStatus[name]?.role || '';

      roleSelect.addEventListener('change', () => {
        playersStatus[name].role = roleSelect.value;
        checkRoleCountMismatch();
      });
      statusLi.appendChild(roleSelect);

      // Aktion (z.B. T√∂ten, Retten)
      if (playersStatus[name]?.alive) {
        const actionSelect = document.createElement('select');
        actionSelect.innerHTML = `
          <option value="">Aktion w√§hlen</option>
          <option value="kill">T√∂ten</option>
          <option value="save">Retten</option>
        `;
        statusLi.appendChild(actionSelect);
      }

      playersStatusList.appendChild(statusLi);
    });

    // Rollen-Count Warnung aktualisieren
    checkRoleCountMismatch();
  }

  function checkRoleCountMismatch() {
    const totalRoles = Object.values(roles).reduce((a, b) => a + b, 0);
    if (players.length !== totalRoles) {
      roleWarningDiv.textContent = 'Achtung: Rollenanzahl stimmt nicht mit der Spielerzahl √ºberein!';
    } else {
      roleWarningDiv.textContent = '';
    }

    // Alle Rollen und deren Anzahl gleichzeitig anzeigen
    let rolesText = 'Rollenverteilung: ';
    for (const role in roles) {
      rolesText += `${role}: ${roles[role]} | `;
    }
    // Entferne das letzte '| '
    rolesText = rolesText.slice(0, -3);
    roleWarningDiv.textContent += (roleWarningDiv.textContent ? ' | ' : '') + rolesText;
  }

  // Spieler hinzuf√ºgen
  document.getElementById('addPlayer').addEventListener('click', () => {
    const name = playerNameInput.value.trim();
    if (name && !players.includes(name)) {
      players.push(name);
      playersStatus[name] = { alive: true, role: null };
      updatePlayersDisplay();
      playerNameInput.value = '';
    }
  });

  // Alle Spieler entfernen
  document.getElementById('clearPlayers').addEventListener('click', () => {
    players.length = 0;
    for (const key in playersStatus) delete playersStatus[key];
    updatePlayersDisplay();
  });

  // Rollen-Konfiguration generieren
  function generateRoleDropdowns() {
    rolesControlsContainer.innerHTML = '';
    for (const role in roles) {
      const div = document.createElement('div');
      div.className = 'row';

      const label = document.createElement('label');
      label.textContent = role;
      div.appendChild(label);

      const select = document.createElement('select');
      const maxCount = players.length;
      select.innerHTML = Array.from({length: maxCount + 1}, (_, i) => `<option value="${i}">${i}</option>`).join('');
      select.value = roles[role] || 0;

      select.addEventListener('change', () => {
        roles[role] = parseInt(select.value);
        checkRoleCountMismatch();
      });
      div.appendChild(select);

      rolesControlsContainer.appendChild(div);
    }
  }

  // Alle Dorfbewohner
  document.getElementById('autoFillVillagers').addEventListener('click', () => {
    for (const role in roles) {
      roles[role] = 0;
    }
    roles['Dorfbewohner'] = players.length;
    generateRoleDropdowns();
    checkRoleCountMismatch();
  });

  // Rollen zuf√§llig zuweisen
  document.getElementById('assignRoles').addEventListener('click', () => {
    const totalRolesCount = Object.values(roles).reduce((a, b) => a + b, 0);
    if (players.length !== totalRolesCount) {
      alert('Die Rollenanzahl stimmt nicht mit der Spielerzahl √ºberein!');
      return;
    }

    const rolePool = [];
    for (const role in roles) {
      for (let i = 0; i < roles[role]; i++) {
        rolePool.push(role);
      }
    }

    // Spieler mischen
    const shuffledPlayers = [...players].sort(() => Math.random() - 0.5);

    // Rollen zuweisen
    for (let i = 0; i < shuffledPlayers.length; i++) {
      const playerName = shuffledPlayers[i];
      const role = rolePool[i];
      playersStatus[playerName].role = role;
    }
    updatePlayersDisplay();
  });

  // Rollen zur√ºcksetzen
  document.getElementById('clearRoles').addEventListener('click', () => {
    for (const role in roles) {
      roles[role] = 0;
    }
    generateRoleDropdowns();
    checkRoleCountMismatch();
  });

  // Rollen initialisieren
  roles['Dorfbewohner'] = players.length;
  generateRoleDropdowns();

});
</script>

</body>
</html>
